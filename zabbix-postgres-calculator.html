<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calculadora PostgreSQL + TimescaleDB para Zabbix</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Custom slider styles for better appearance */
    input[type="range"] {
      -webkit-appearance: none;
      appearance: none;
      cursor: pointer;
    }

    input[type="range"]::-webkit-slider-track {
      background-color: rgba(255, 255, 255, 0.2);
      border-radius: 0.5rem;
      height: 0.5rem;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      margin-top: -4px;
      background-color: #fb923c;
      height: 1rem;
      width: 1rem;
      border-radius: 50%;
    }

    input[type="range"]::-moz-range-track {
      background-color: rgba(255, 255, 255, 0.2);
      border-radius: 0.5rem;
      height: 0.5rem;
    }

    input[type="range"]::-moz-range-thumb {
      border: none;
      background-color: #fb923c;
      height: 1rem;
      width: 1rem;
      border-radius: 50%;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useMemo } = React;

    // Lucide React icons as SVG components
    const Database = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <ellipse cx="12" cy="5" rx="9" ry="3"></ellipse>
        <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path>
        <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path>
      </svg>
    );

    const HardDrive = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <line x1="22" y1="12" x2="2" y2="12"></line>
        <path d="M5.45 5.11L2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z"></path>
        <line x1="6" y1="16" x2="6.01" y2="16"></line>
        <line x1="10" y1="16" x2="10.01" y2="16"></line>
      </svg>
    );

    const Clock = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <circle cx="12" cy="12" r="10"></circle>
        <polyline points="12 6 12 12 16 14"></polyline>
      </svg>
    );

    const Cpu = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <rect x="4" y="4" width="16" height="16" rx="2" ry="2"></rect>
        <rect x="9" y="9" width="6" height="6"></rect>
        <line x1="9" y1="1" x2="9" y2="4"></line>
        <line x1="15" y1="1" x2="15" y2="4"></line>
        <line x1="9" y1="20" x2="9" y2="23"></line>
        <line x1="15" y1="20" x2="15" y2="23"></line>
        <line x1="20" y1="9" x2="23" y2="9"></line>
        <line x1="20" y1="14" x2="23" y2="14"></line>
        <line x1="1" y1="9" x2="4" y2="9"></line>
        <line x1="1" y1="14" x2="4" y2="14"></line>
      </svg>
    );

    function ZabbixMemoryCalculator() {
      const [items, setItems] = useState(5000000);
      const [intervalSeconds, setIntervalSeconds] = useState(60);
      const [totalMemoryGiB, setTotalMemoryGiB] = useState(256);
      const [historyRetentionDays, setHistoryRetentionDays] = useState(7);
      const [trendsRetentionDays, setTrendsRetentionDays] = useState(365);
      const [historyPartitionHours, setHistoryPartitionHours] = useState(24);
      const [trendsPartitionDays, setTrendsPartitionDays] = useState(7);

      const calculations = useMemo(() => {
        const HISTORY_BYTES_PER_VALUE = 110;
        const TRENDS_BYTES_PER_VALUE = 80;
        const SECONDS_PER_DAY = 86400;
        const TRENDS_VALUES_PER_DAY = 24;
        const INDEX_DATA_RATIO = 0.5;
        const TARGET_MEMORY_PERCENT = 0.25;

        const nvps = items / intervalSeconds;
        const historyBytesPerDay = nvps * HISTORY_BYTES_PER_VALUE * SECONDS_PER_DAY;
        const historyGiBPerDay = historyBytesPerDay / (1024 ** 3);
        const trendsBytesPerDay = items * TRENDS_VALUES_PER_DAY * TRENDS_BYTES_PER_VALUE;
        const trendsGiBPerDay = trendsBytesPerDay / (1024 ** 3);
        const targetMemoryGiB = totalMemoryGiB * TARGET_MEMORY_PERCENT;
        const historyIndexGiBPerDay = historyGiBPerDay * INDEX_DATA_RATIO;
        const trendsIndexGiBPerDay = trendsGiBPerDay * INDEX_DATA_RATIO;
        const historyPartitionDays = historyPartitionHours / 24;
        const historyPartitionSizeGiB = historyGiBPerDay * historyPartitionDays;
        const historyPartitionIndexGiB = historyPartitionSizeGiB * INDEX_DATA_RATIO;
        const trendsPartitionSizeGiB = trendsGiBPerDay * trendsPartitionDays;
        const trendsPartitionIndexGiB = trendsPartitionSizeGiB * INDEX_DATA_RATIO;
        const totalHistoryGiB = historyGiBPerDay * historyRetentionDays;
        const totalTrendsGiB = trendsGiBPerDay * trendsRetentionDays;
        const totalStorageTiB = (totalHistoryGiB + totalTrendsGiB) / 1024;
        const historyPartitionCount = Math.ceil(historyRetentionDays / historyPartitionDays);
        const trendsPartitionCount = Math.ceil(trendsRetentionDays / trendsPartitionDays);
        const totalHotIndexMemoryGiB = historyPartitionIndexGiB + trendsPartitionIndexGiB;
        const memoryUsagePercent = (totalHotIndexMemoryGiB / targetMemoryGiB) * 100;

        return {
          nvps,
          historyGiBPerDay,
          trendsGiBPerDay,
          targetMemoryGiB,
          historyPartitionDays,
          trendsPartitionDays,
          historyPartitionSizeGiB,
          historyPartitionIndexGiB,
          trendsPartitionSizeGiB,
          trendsPartitionIndexGiB,
          totalHistoryGiB,
          totalTrendsGiB,
          totalStorageTiB,
          historyPartitionCount,
          trendsPartitionCount,
          totalHotIndexMemoryGiB,
          memoryUsagePercent
        };
      }, [items, intervalSeconds, totalMemoryGiB, historyRetentionDays, trendsRetentionDays, historyPartitionHours, trendsPartitionDays]);

      const formatNumber = (num) => num.toLocaleString('es-ES', { maximumFractionDigits: 2 });

      return (
        <div className="min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 p-6">
          <div className="max-w-5xl mx-auto">
            <div className="bg-white/10 backdrop-blur-lg rounded-2xl shadow-2xl p-8 border border-white/20">
              <div className="flex items-center gap-3 mb-8">
                <Database className="w-10 h-10 text-blue-400" />
                <h1 className="text-3xl font-bold text-white">
                  Calculadora PostgreSQL + TimescaleDB para Zabbix
                </h1>
              </div>

              <div className="grid md:grid-cols-5 gap-6 mb-8">
                <div className="bg-white/5 rounded-xl p-6 border border-white/10">
                  <label className="block text-blue-300 text-sm font-semibold mb-3">
                    <Cpu className="w-4 h-4 inline mr-2" />
                    Número de Items
                  </label>
                  <input
                    type="number"
                    value={items}
                    onChange={(e) => setItems(Number(e.target.value))}
                    className="w-full bg-white/10 text-white border border-white/20 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-400"
                    min="1"
                  />
                  <p className="text-xs text-gray-400 mt-2">{formatNumber(items)} items</p>
                </div>

                <div className="bg-white/5 rounded-xl p-6 border border-white/10">
                  <label className="block text-blue-300 text-sm font-semibold mb-3">
                    <Clock className="w-4 h-4 inline mr-2" />
                    Intervalo de Recolección (seg)
                  </label>
                  <input
                    type="number"
                    value={intervalSeconds}
                    onChange={(e) => setIntervalSeconds(Number(e.target.value))}
                    className="w-full bg-white/10 text-white border border-white/20 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-400"
                    min="1"
                  />
                  <p className="text-xs text-gray-400 mt-2">Cada {intervalSeconds}s</p>
                </div>

                <div className="bg-white/5 rounded-xl p-6 border border-white/10">
                  <label className="block text-blue-300 text-sm font-semibold mb-3">
                    <HardDrive className="w-4 h-4 inline mr-2" />
                    Memoria Total (GiB)
                  </label>
                  <input
                    type="number"
                    value={totalMemoryGiB}
                    onChange={(e) => setTotalMemoryGiB(Number(e.target.value))}
                    className="w-full bg-white/10 text-white border border-white/20 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-400"
                    min="1"
                  />
                  <p className="text-xs text-gray-400 mt-2">{formatNumber(totalMemoryGiB)} GiB RAM</p>
                </div>

                <div className="bg-white/5 rounded-xl p-6 border border-white/10">
                  <label className="block text-orange-300 text-sm font-semibold mb-3">
                    📈 Retención History (días)
                  </label>
                  <input
                    type="number"
                    value={historyRetentionDays}
                    onChange={(e) => setHistoryRetentionDays(Number(e.target.value))}
                    className="w-full bg-white/10 text-white border border-white/20 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-orange-400"
                    min="1"
                  />
                  <p className="text-xs text-gray-400 mt-2">{historyRetentionDays} días</p>
                </div>

                <div className="bg-white/5 rounded-xl p-6 border border-white/10">
                  <label className="block text-green-300 text-sm font-semibold mb-3">
                    📉 Retención Trends (días)
                  </label>
                  <input
                    type="number"
                    value={trendsRetentionDays}
                    onChange={(e) => setTrendsRetentionDays(Number(e.target.value))}
                    className="w-full bg-white/10 text-white border border-white/20 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-green-400"
                    min="1"
                  />
                  <p className="text-xs text-gray-400 mt-2">{trendsRetentionDays} días</p>
                </div>
              </div>

              <div className="bg-gradient-to-r from-blue-600/20 to-purple-600/20 rounded-xl p-6 mb-8 border border-blue-400/30">
                <h2 className="text-xl font-bold text-white mb-4">📊 Cálculos Base</h2>
                <div className="grid md:grid-cols-2 gap-4 text-white">
                  <div className="bg-white/5 rounded-lg p-4">
                    <p className="text-sm text-gray-300">NVPS (New Values Per Second)</p>
                    <p className="text-2xl font-bold text-blue-300">{formatNumber(calculations.nvps)}</p>
                    <p className="text-xs text-gray-400 mt-1">{formatNumber(items)} ÷ {intervalSeconds}s</p>
                  </div>
                  <div className="bg-white/5 rounded-lg p-4">
                    <p className="text-sm text-gray-300">Memoria para Índices Hot (25%)</p>
                    <p className="text-2xl font-bold text-green-300">{formatNumber(calculations.targetMemoryGiB)} GiB</p>
                    <p className="text-xs text-gray-400 mt-1">{formatNumber(totalMemoryGiB)} GiB × 25%</p>
                  </div>
                </div>
              </div>

              <div className="grid md:grid-cols-2 gap-6 mb-8">
                <div className="bg-gradient-to-br from-orange-600/20 to-red-600/20 rounded-xl p-6 border border-orange-400/30">
                  <h3 className="text-lg font-bold text-white mb-4">📈 History (sin comprimir)</h3>
                  <div className="space-y-3 text-white">
                    <div className="flex justify-between items-center">
                      <span className="text-gray-300">Tamaño por día:</span>
                      <span className="font-bold text-orange-300">{formatNumber(calculations.historyGiBPerDay)} GiB</span>
                    </div>
                    <div className="text-xs text-gray-400 bg-white/5 rounded p-2">
                      {formatNumber(calculations.nvps)} NVPS × 110 bytes × 86,400s
                    </div>
                    <div className="flex justify-between items-center pt-2 border-t border-white/10">
                      <span className="text-gray-300">Total ({historyRetentionDays} días):</span>
                      <span className="font-bold text-orange-200">{formatNumber(calculations.totalHistoryGiB)} GiB</span>
                    </div>
                  </div>
                </div>

                <div className="bg-gradient-to-br from-green-600/20 to-teal-600/20 rounded-xl p-6 border border-green-400/30">
                  <h3 className="text-lg font-bold text-white mb-4">📉 Trends (comprimido)</h3>
                  <div className="space-y-3 text-white">
                    <div className="flex justify-between items-center">
                      <span className="text-gray-300">Tamaño por día:</span>
                      <span className="font-bold text-green-300">{formatNumber(calculations.trendsGiBPerDay)} GiB</span>
                    </div>
                    <div className="text-xs text-gray-400 bg-white/5 rounded p-2">
                      {formatNumber(items)} items × 24 valores × 80 bytes
                    </div>
                    <div className="flex justify-between items-center pt-2 border-t border-white/10">
                      <span className="text-gray-300">Total ({trendsRetentionDays} días):</span>
                      <span className="font-bold text-green-200">{formatNumber(calculations.totalTrendsGiB)} GiB</span>
                    </div>
                  </div>
                </div>
              </div>

              <div className="bg-gradient-to-r from-purple-600/20 to-pink-600/20 rounded-xl p-6 mb-8 border border-purple-400/30">
                <h2 className="text-xl font-bold text-white mb-4">🎯 Tamaño de Particiones</h2>
                <p className="text-sm text-gray-300 mb-6">
                  Ajusta la duración de las particiones según tus necesidades
                </p>

                <div className="grid md:grid-cols-2 gap-6 mb-6">
                  <div className="bg-white/5 rounded-lg p-5">
                    <label className="block text-orange-300 text-sm font-semibold mb-3">
                      ⏰ Duración History Partition
                    </label>
                    <div className="space-y-3">
                      <input
                        type="range"
                        min="1"
                        max="48"
                        value={historyPartitionHours}
                        onChange={(e) => setHistoryPartitionHours(Number(e.target.value))}
                        className="w-full h-2 bg-white/20 rounded-lg"
                      />
                      <div className="flex justify-between items-center">
                        <span className="text-xs text-gray-400">1h</span>
                        <span className="text-lg font-bold text-orange-300">
                          {historyPartitionHours}h ({(historyPartitionHours / 24).toFixed(2)} días)
                        </span>
                        <span className="text-xs text-gray-400">48h</span>
                      </div>
                    </div>
                  </div>

                  <div className="bg-white/5 rounded-lg p-5">
                    <label className="block text-green-300 text-sm font-semibold mb-3">
                      📅 Duración Trends Partition
                    </label>
                    <div className="space-y-3">
                      <input
                        type="range"
                        min="1"
                        max="30"
                        value={trendsPartitionDays}
                        onChange={(e) => setTrendsPartitionDays(Number(e.target.value))}
                        className="w-full h-2 bg-white/20 rounded-lg"
                        style={{ accentColor: '#4ade80' }}
                      />
                      <div className="flex justify-between items-center">
                        <span className="text-xs text-gray-400">1 día</span>
                        <span className="text-lg font-bold text-green-300">
                          {trendsPartitionDays} días
                        </span>
                        <span className="text-xs text-gray-400">30 días</span>
                      </div>
                    </div>
                  </div>
                </div>

                <div className="grid md:grid-cols-2 gap-6">
                  <div className="bg-white/5 rounded-lg p-5">
                    <h4 className="font-bold text-orange-300 mb-3 text-lg">History Partitions</h4>
                    <div className="space-y-2 text-white">
                      <div className="flex justify-between">
                        <span className="text-gray-300">Días por partición:</span>
                        <span className="font-bold">{calculations.historyPartitionDays} días</span>
                      </div>
                      <div className="flex justify-between">
                        <span className="text-gray-300">Tamaño partición:</span>
                        <span className="font-bold">{formatNumber(calculations.historyPartitionSizeGiB)} GiB</span>
                      </div>
                      <div className="flex justify-between bg-white/10 rounded p-2">
                        <span className="text-gray-300">Índice partición:</span>
                        <span className="font-bold text-orange-300">{formatNumber(calculations.historyPartitionIndexGiB)} GiB</span>
                      </div>
                      <div className="flex justify-between text-sm">
                        <span className="text-gray-400">Particiones totales:</span>
                        <span>{calculations.historyPartitionCount}</span>
                      </div>
                    </div>
                  </div>

                  <div className="bg-white/5 rounded-lg p-5">
                    <h4 className="font-bold text-green-300 mb-3 text-lg">Trends Partitions</h4>
                    <div className="space-y-2 text-white">
                      <div className="flex justify-between">
                        <span className="text-gray-300">Días por partición:</span>
                        <span className="font-bold">{calculations.trendsPartitionDays} días</span>
                      </div>
                      <div className="flex justify-between">
                        <span className="text-gray-300">Tamaño partición:</span>
                        <span className="font-bold">{formatNumber(calculations.trendsPartitionSizeGiB)} GiB</span>
                      </div>
                      <div className="flex justify-between bg-white/10 rounded p-2">
                        <span className="text-gray-300">Índice partición:</span>
                        <span className="font-bold text-green-300">{formatNumber(calculations.trendsPartitionIndexGiB)} GiB</span>
                      </div>
                      <div className="flex justify-between text-sm">
                        <span className="text-gray-400">Particiones totales:</span>
                        <span>{calculations.trendsPartitionCount}</span>
                      </div>
                    </div>
                  </div>
                </div>

                <div className="mt-6 bg-white/10 rounded-lg p-4">
                  <div className="flex justify-between items-center mb-2">
                    <span className="text-white font-semibold">Memoria Hot Utilizada:</span>
                    <span className="text-xl font-bold text-yellow-300">
                      {formatNumber(calculations.totalHotIndexMemoryGiB)} GiB
                    </span>
                  </div>
                  <div className="w-full bg-gray-700 rounded-full h-3 overflow-hidden">
                    <div
                      className={`h-full transition-all duration-500 ${
                        calculations.memoryUsagePercent > 100 ? 'bg-red-500' :
                        calculations.memoryUsagePercent > 80 ? 'bg-yellow-500' : 'bg-green-500'
                      }`}
                      style={{ width: `${Math.min(calculations.memoryUsagePercent, 100)}%` }}
                    />
                  </div>
                  <p className="text-xs text-gray-400 mt-2">
                    {formatNumber(calculations.memoryUsagePercent)}% del target de memoria hot
                  </p>
                </div>
              </div>

              <div className="bg-gradient-to-r from-blue-600/20 to-cyan-600/20 rounded-xl p-6 border border-cyan-400/30">
                <h2 className="text-xl font-bold text-white mb-4">💾 Almacenamiento Total Estimado</h2>
                <div className="text-center">
                  <p className="text-5xl font-bold text-cyan-300 mb-2">
                    {formatNumber(calculations.totalStorageTiB)} TiB
                  </p>
                  <p className="text-gray-300 text-sm">
                    Para {historyRetentionDays} días de History + {trendsRetentionDays} días de Trends (datos + índices)
                  </p>
                </div>
              </div>
            </div>

            <div className="text-center mt-6 text-gray-400 text-sm">
              <p>💡 Los índices representan el 50% del tamaño total de cada tabla</p>
              <p>🔥 Las particiones "hot" son las más recientes de cada tabla</p>
            </div>
          </div>
        </div>
      );
    }

    ReactDOM.render(
      <React.StrictMode>
        <ZabbixMemoryCalculator />
      </React.StrictMode>,
      document.getElementById('root')
    );
  </script>
</body>
</html>
